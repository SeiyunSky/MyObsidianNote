 ![[Pasted image 20251010213414.png]]
### 基于中位数的梯度下降
• 基于中位数的梯度下降：$$(\tilde{O}(\frac{\alpha}{\sqrt{n}}+\frac{1}{\sqrt{n m}}+\frac{1}{n}))$$若$(n \gtrsim m)$，则对强凸损失函数是阶最优的


### 基于均值裁剪的梯度下降
• 基于截尾均值的梯度下降：$$(\tilde{O}(\frac{\alpha}{\sqrt{n}}+\frac{1}{\sqrt{n m}}))$$对强凸损失函数是阶最优的。


### 问题提出
在本节中，我们正式提出问题，并介绍几个对我们的算法设计和分析至关重要的概念。假设训练数据点是从样本空间 $\mathcal{Z}$ 上的某个未知分布 $\mathcal{D}$ 中采样得到的。设 $f(w ; z)$ 是与数据点 $z$ 相关联的参数向量 $w \in \mathcal{W} \subseteq \mathbb{R}^{d}$ 的损失函数，其中 $\mathcal{W}$ 是参数空间，$F(w):=\mathbb{E}_{z \sim \mathcal{D}}[f(w ; z)]$ 是相应的总体损失函数。我们的目标是学习一个由参数定义的模型，该模型使总体损失最小化：

$$
w^{*} = \arg\min_{w \in \mathcal{W}} F(w) . \tag{1}
$$

#### **本文采用的假设**
**定义 1**（按坐标中位数）。
对于向量 $x^{i} \in \mathbb{R}^{d}$, $i \in [m]$，按坐标中位数 $g := \mathrm{med} \\{ x^{i} : i \in [m] \\}$ 是一个向量，其第 $k$ 个坐标为 $g_{k} = \mathrm{med} \\{ x_{k}^{i} : i \in [m] \\}$，对于每个 $k \in [d]$，其中 $\mathrm{med}$ 是通常的（一维）中位数。

**定义 2**（按坐标修剪均值）。
对于 $\beta \in [0, \frac{1}{2}]$ 和向量 $x^{i} \in \mathbb{R}^{d}$, $i \in [m]$，按坐标的 $\beta$ 修剪均值 $g := \mathrm{trmean}_{\beta} \\{ x^{i} : i \in [m] \\}$ 是一个向量，其第 $k$ 个坐标对于每个 $k \in [d]$ 均为 $g_{k} = \frac{1}{(1-2\beta) m} \sum_{x \in U_{k}} x$。这里，$U_{k}$ 是 $\\{ x_{k}^{1}, \dots, x_{k}^{m} \\}$ 的一个子集，通过移除其元素中最大和最小的 $\beta$ 比例部分获得。


**定义 3**（随机向量的方差）。
对于随机向量 $x$，其方差定义为 $\mathrm{Var}(x) := \mathbb{E}[\| x - \mathbb{E}[x] \|_{2}^{2}]$。

**定义 4**（绝对偏度）。
对于一维随机变量 $X$，定义其绝对偏度 $\gamma(X)$ 为 $\gamma(X) := \frac{\mathbb{E}[|X - \mathbb{E}[X]|^{3}]}{\mathrm{Var}(X)^{3/2}}$。对于一个 $d$ 维随机向量 $x$，我们将其绝对偏度定义为 $x$ 的每个坐标的绝对偏度向量，即 $\gamma(x) := [\gamma(x_1), \gamma(x_2), \cdots, \gamma(x_d)]^{\top}$。

**定义 5**（亚指数随机变量）。
具有 $\mathbb{E}[X] = \mu$ 的随机变量 $X$ 被称为 $v$-亚指数的，如果
$\mathbb{E}[e^{\lambda(X-\mu)}] \leq e^{\frac{1}{2} v \lambda^{2}}$，$\forall |\lambda| < \frac{1}{\theta}$。

最后，我们需要凸分析中关于可微函数 $h(\cdot): \mathbb{R}^{d} \to \mathbb{R}$ 的几个标准概念。

**定义 6**（利普希茨）——函数连续
如果 $|h(w) - h(w')| \leq L \| w - w' \|_{2}$，$\forall w, w'$，则 $h$ 是 $L$-利普希茨的。

**定义 7**（平滑性）——函数平滑，**给出了上界**
若 $\| \nabla h(w) - \nabla h(w') \|_{2} \leq L' \| w - w' \|_{2}$，$\forall w, w'$，则 $h$ 是 $L'$-平滑的。

**定义 8**（强凸性）——**函数强凸有明确下界**，即**存在唯一的最小值点​**​，能推导出梯度与最优解的关系和函数值差距与最优解的关系
如果 $h(w') \geq h(w) + \langle \nabla h(w), w' - w \rangle + \frac{\lambda}{2} \| w' - w \|_{2}^{2}$，$\forall w, w'$，则 $h$ 是 $\lambda$-强凸的。

### 鲁棒分布式梯度下降
**假设 1**（$f$ 和 $F$ 的平滑性）。对于任意 $z \in \mathcal{Z}$，$f(\cdot; z)$ 相对于其第一个参数的 $k$-th 坐标的偏导数（记为 $\partial_k f(\cdot; z)$），对于每个 $k \in [d]$ 都是 $L_k$-Lipschitz 的，且函数 $f(\cdot; z)$ 是 $L$-平滑的。令 $\tilde{L} := \sqrt{\sum_{k=1}^{d} L_k^2}$。另假设总体损失函数 $F(\cdot)$ 是 $L_F$-平滑的。
## 基于中位数的梯度下降保证
**假设2**——梯度有界方差
**假设3**——梯度有界偏度
![[Pasted image 20251010213414.png]]
算法流程为：
首先获得参数，对于所有的机器，计算局部梯度
向主服务器发送更新后梯度
主服务器计算聚合梯度
- 中位数
- 裁剪均值
更新模型参数——$w^{t+1} = \beta W(w^t - \eta g(w^t))$

**命题 1.** 假设每个数据点 $z = (x, y) \in \mathbb{R}^{d} \times \mathbb{R}$ 是由 $y = x^{\top} w^{*} + \xi$ 在某种 $w^{*} \in \mathcal{W}$ 下生成的。
假设 $x$ 的元素独立且均匀分布在 $\{-1, 1\}$ 中，且噪声 $\xi \sim \mathcal{N}(0, \sigma^{2})$ 与 $x$ 独立。
在二次损失函数 $f(w ; x, y) = \frac{1}{2}(y - x^{\top} w)^{2}$ 下，我们有 
$\mathrm{Var}(\nabla f(w ; x, y)) = (d-1) \| w - w^{*} \|_{2}^{2} + d \sigma^{2}$ 
和
$\| \gamma(\nabla f(w ; x, y)) \|_{\infty} \leq 480$。
### 定理一 强凸
**定理 1.** 考虑算法 1 中的选项 I。假设假设 1、2 和 3 成立，$F(\cdot)$ 是 $\lambda_{F}$-强凸的，且拜占庭机器的比例 $\alpha$ 满足

$$
\alpha + \sqrt{\frac{d \log (1+n m \hat{L} D)}{m(1-\alpha)}} + 0.4748 \frac{S}{\sqrt{n}} \leq \frac{1}{2} - \epsilon
$$
[点我,为什么要满足0.5](obsidian://open?vault=Note&file=%E8%AE%BA%E6%96%87%E7%A0%94%E7%A9%B6%2F2025.10.9%2F3.1Byzantine%20Multi-Agent%20Optimization%E2%80%93%20Part%20I%E2%8B%86)

对于某个 $\epsilon > 0$。选择步长 $\eta = 1 / L_{F}$。那么，在至少 $1 - \frac{4d}{(1+n m \hat{L} D)^{d}}$ 的概率下，经过 $T$ 次并行迭代后，我们有

$$
\left\| w^{T} - w^{*} \right\|_{2} \leq \left(1 - \frac{\lambda_{F}}{L_{F} + \lambda_{F}} \right)^{T} \left\| w^{0} - w^{*} \right\|_{2} + \frac{2}{\lambda_{F}} \Delta,
$$

其中

$$
\Delta := \mathcal{O} \left( C_{\epsilon} V \left( \frac{\alpha}{\sqrt{n}} + \sqrt{\frac{d \log (n m \hat{L} D)}{n m}} + \frac{S}{n} \right) \right),
$$

$$
C_{\epsilon} := \sqrt{2 \pi} \exp \left( \frac{1}{2} \left( \Phi^{-1}(1-\epsilon) \right)^{2} \right), \tag{4}
$$

这里 $\Phi^{-1}(\cdot)$ 是标准高斯分布累积分布函数 $\Phi(\cdot)$ 的反函数。

##### **证明：**
**定理 8.** 定义

$$
g^{i}(w) =
\begin{cases} 
\nabla F_{i}(w) & i \in [m] \setminus \mathcal{B}, \\
* & i \in \mathcal{B}.
\end{cases} \tag{25}
$$

以及 $g^{i}(w)$ 的按坐标中位数：

$$
g(w) = \mathrm{med} \{ g^{i}(w) : i \in [m] \}. \tag{26}
$$

假设假设 1、2 和 3 成立，且不等式 (2) 对某个 $\epsilon > 0$ 成立。则以至少 $1 - \frac{4d}{(1 + nm\widehat{L}D)^{d}}$ 的概率，对所有 $w \in \mathcal{W}$ 有**误差上界​**​：

$$
\| g(w) - \nabla F(w) \|_{2} \leq 2\sqrt{2} \cdot \frac{1}{nm} + \sqrt{2} \cdot \frac{C_{\epsilon}}{\sqrt{n}} V \left( \alpha + \sqrt{ \frac{d \log(1 + nm\widehat{L}D)}{m(1 - \alpha)} } + 0.4748 \frac{S}{\sqrt{n}} \right), \tag{27}
$$

其中 $C_{\epsilon}$ 按 (4) 定义。

**证明.** 见附录 B.1。

然后，我们继续分析鲁棒分布式梯度下降算法的收敛性。我们以 (27) 中的界对所有 $w \in \mathcal{W}$ 成立为条件。在第 $t$ 次迭代中，我们定义

$$
\widehat{w}^{t+1} = w^{t} - \eta g(w^{t}).
$$

因此，我们有 $w^{t+1} = \Pi_{\mathcal{W}}(\widehat{w}^{t+1})$。根据欧几里得投影的性质，我们知道

$$
\| w^{t+1} - w^{*} \|_{2} \leq \| \widehat{w}^{t+1} - w^{*} \|_{2}.
$$

将$w^{t+1}$进行拆分，应用三角不等式$∥a+b∥≤∥a∥+∥b∥$
**得到一个理想情况下的误差和估计误差导致的噪声**
$$
\begin{align*}
\| w^{t+1} - w^{*} \|_{2} &\leq \| w^{t} - \eta g(w^{t}) - w^{*} \|_{2} \\
&\leq \| w^{t} - \eta \nabla F(w^{t}) - w^{*} \|_{2} + \eta \| g(w^{t}) - \nabla F(w^{t}) \|_{2}. \tag{28}
\end{align*}
$$

同时，**内积双线性性质有**

$$
\| w^{t} - \eta \nabla F(w^{t}) - w^{*} \|_{2}^{2} = \| w^{t} - w^{*} \|_{2}^{2} - 2\eta \langle w^{t} - w^{*}, \nabla F(w^{t}) \rangle + \eta^{2} \| \nabla F(w^{t}) \|_{2}^{2}. \tag{29}
$$

由于 $F(w)$ 是 $\lambda_{F}$-强凸的，根据强凸函数的共轭性，我们得到

$$
\langle w^{t} - w^{*}, \nabla F(w^{t}) \rangle \geq \frac{L_{F} \lambda_{F}}{L_{F} + \lambda_{F}} \| w^{t} - w^{*} \|_{2}^{2} + \frac{1}{L_{F} + \lambda_{F}} \| \nabla F(w^{t}) \|_{2}^{2}.
$$

令 $\eta = \frac{1}{L_{F}}$，则我们得到

$$
\begin{align*}
\| w^{t} - \eta \nabla F(w^{t}) - w^{*} \|_{2}^{2} &\leq \left(1 - \frac{2\lambda_{F}}{L_{F} + \lambda_{F}}\right) \| w^{t} - w^{*} \|_{2}^{2} - \frac{2}{L_{F}(L_{F} + \lambda_{F})} \| \nabla F(w^{t}) \|_{2}^{2} + \frac{1}{L_{F}^{2}} \| \nabla F(w^{t}) \|_{2}^{2} \\
&\leq \left(1 - \frac{2\lambda_{F}}{L_{F} + \lambda_{F}}\right) \| w^{t} - w^{*} \|_{2}^{2},
\end{align*}
$$

其中第二个不等式我们使用了 $\lambda_{F} \leq L_{F}$ 的事实。利用 $\sqrt{1-x} \leq 1 - \frac{x}{2}$ 的事实，我们得到

$$
\| w^{t} - \eta \nabla F(w^{t}) - w^{*} \|_{2} \leq \left(1 - \frac{\lambda_{F}}{L_{F} + \lambda_{F}}\right) \| w^{t} - w^{*} \|_{2}. \tag{30}
$$

结合 (28) 和 (30)，我们得到

$$
\| w^{t+1} - w^{*} \|_{2} \leq \left(1 - \frac{\lambda_{F}}{L_{F} + \lambda_{F}}\right) \| w^{t} - w^{*} \|_{2} + \frac{1}{L_{F}} \Delta, \tag{31}
$$

其中

$$
\Delta = 2\sqrt{2} \cdot \frac{1}{nm} + \sqrt{2} \cdot \frac{C_{\epsilon}}{\sqrt{n}} V \left( \alpha + \sqrt{ \frac{d \log(1 + nm\widehat{L}D)}{m(1 - \alpha)} } + 0.4748 \frac{S}{\sqrt{n}} \right).
$$

然后我们可以通过迭代 (31) 来完成证明。

##### B.1 定理 8 的证明

定理 8 的证明依赖于对存在对抗数据时均值中位数估计量的仔细分析以及覆盖网论证。
![[Pasted image 20251010224047.png]]
我们首先考虑一维随机变量的鲁棒估计的一般问题。
假设有 $m$ 个工作机器，其中 $q$ 个是拜占庭机器，存储 $n$ 个对抗数据（回忆 $\alpha := q/m$）。
其他 $m(1-\alpha)$ 个正常工作机器各自存储某个一维随机变量 $x \sim \mathcal{D}$ 的 $n$ 个独立同分布样本。
用 $x^{i,j}$ 表示第 $i$ 个工作机器中的第 $j$ 个样本。

令 $\mu := \mathbb{E}[x]$, $\sigma^{2} := \text{Var}(x)$，$\gamma(x)$ 为 $x$ 的绝对偏度。
此外，定义 $\bar{x}^{i}$ 为第 $i$ 个机器中样本的平均值，即 $\bar{x}^{i} = \frac{1}{n}\sum_{j=1}^{n}x^{i,j}$。

对于任意 $z \in \mathbb{R}$，定义 $\widetilde{p}(z):=\frac{1}{m(1-\alpha)}\sum_{i\in[m]\setminus\mathcal{B}} \mathbb{1}(\bar{x}^{i} \leq z)$ 为正常工作机器上样本均值的经验分布函数。我们有以下关于 $\widetilde{p}(z)$ 的结果。

**引理 1.** 假设对于固定的 $t>0$，对于某个 $\epsilon>0$，我们有

$$
\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma(x)}{\sqrt{n}}\leq\frac{1}{2}-\epsilon, \qquad(32)
$$

那么，以至少 $1-4e^{-2t}$ 的概率，我们有

$$
\widetilde{p}\left(\mu+C_{\epsilon}\frac{\sigma}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma(x)}{\sqrt{n}})\right)\geq\frac{1}{2}+\alpha, \qquad(33)
$$

和

$$
\widetilde{p}\left(\mu-C_{\epsilon}\frac{\sigma}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma(x)}{\sqrt{n}})\right)\leq\frac{1}{2}-\alpha. \qquad(34)
$$
其中 $C_{\epsilon}$ 如 (4) 所定义，γ(x)/√n代表了偏度和样本数决定的误差，并且需要考虑工人数有限导致的误差。
**证明.** 见附录 B.2。

我们进一步定义所有 $m$ 台机器上的分布函数为 $\widehat{p}(z):=\frac{1}{m}\sum_{i\in[m]}\mathbb{1}(\bar{x}^{i} \leq z)$。
我们有以下关于 $\widehat{p}(z)$ 和均值中位数估计量 $\text{med}\{\bar{x}^{i}:i\in[m]\}$ 的直接推论。
**推论 1.** 假设条件 (32) 满足。那么，以至少 $1-4e^{-2t}$ 的概率，我们有

$$
\widehat{p}\left(\mu+C_{\epsilon}\frac{\sigma}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma(x)}{\sqrt{n}})\right)\geq\frac{1}{2}, \qquad(35)
$$

和

$$
\widehat{p}\left(\mu-C_{\epsilon}\frac{\sigma}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma(x)}{\sqrt{n}})\right)\leq\frac{1}{2}. \qquad(36)
$$

因此，我们以至少 $1-4e^{-2t}$ 的概率有

$$
|\text{med}\{\bar{x}^{i}:i\in[m]\}-\mu|\leq C_{\epsilon}\frac{\sigma}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma(x)}{\sqrt{n}}). \qquad(37)
$$

**证明.** 可以很容易地验证，对于任意 $z \in \mathbb{R}$，我们有 $|\widehat{p}(z)-\widetilde{p}(z)|\leq\alpha$，这得到了结果 (35) 和 (36)。结果 (37) 可以利用 $\widehat{p}(\text{med}\{\bar{x}^{i}:i\in[m]\})=1/2$ 的事实推导出来。$\square$

引理 1 和推论 1 可以转化为梯度的估计量。
按照 (25) 和 (26) 定义 $g^{i}(w)$ 和 $g(w)$，并令 $g_{k}^{i}(w)$ 和 $g_{k}(w)$ 分别为 $g^{i}(w)$ 和 $g(w)$ 的第 $k$ 个坐标。此外，对于任意 $w\in\mathcal{W},\,k\in[d]$ 和 $z\in \mathbb{R}$，我们定义正常机器上梯度第 $k$ 个坐标的经验分布函数：

$$
\widetilde{p}(z;w,k)=\frac{1}{m(1-\alpha)}\sum_{i\in[m]\setminus\mathcal{B}}\mathbb{1}(g_{k}^{i}(w)\leq z). \qquad(38)$$
在所有 $m$ 台机器上定义：

$$ 
\widehat{p}(z;w,k)=\frac{1}{m}\sum_{i=1}^{m}\mathbb{1}\left(g_{k}^{i}(w)\leq z\right).\qquad(39) 
$$ 

我们使用符号 $\partial_{k}$ 表示任意函数对其第 $k$ 个参数的偏导数。我们还使用简化记号 $\sigma_{k}^{2}(w):=\text{Var}(\partial_{k}f(w;z))$ 和 $\gamma_{k}(w):=\gamma(\partial_{k}f(w;z))$。那么，根据引理 1，当 (32) 满足时，对于任意固定的 $w\in\mathcal{W}$ 和 $k\in[d]$，我们以至少 $1-4e^{-2t}$ 的概率有：

$$ 
\widetilde{p}\left(\partial_{k}F(w)+C_{\epsilon}\frac{\sigma_{k}(w)}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma_{k}(w)}{\sqrt{n}});w,k\right)\geq\frac{1}{2}+\alpha,\qquad(40) 
$$ 

和

$$ 
\widetilde{p}\left(\partial_{k}F(w)-C_{\epsilon}\frac{\sigma_{k}(w)}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma_{k}(w)}{\sqrt{n}});w,k\right)\leq\frac{1}{2}-\alpha.\qquad(41) 
$$
进一步，根据推论 1，我们知道以概率 $1-4e^{-2t}$ 有：
$$ 
\left|g_{k}(w)-\partial_{k}F(w)\right|\leq C_{\epsilon}\frac{\sigma_{k}(w)}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma_{k}(w)}{\sqrt{n}}).\qquad(42) 
$$

这里，不等式 (42) 给出了均值中位数估计量在任意固定 $w$ 和任意坐标 $k\in[d]$ 处梯度估计精度的界。为了将此结果扩展到所有 $w\in\mathcal{W}$ 和所有 $d$ 个坐标，我们需要使用联合界和覆盖网论证。

设 $\mathcal{W}_{\delta}=\{w^{1},w^{2},\ldots,w^{N_{\delta}}\}$ 是 $\mathcal{W}$ 的有限子集，使得对于任意 $w\in\mathcal{W}$，存在 $w^{\ell}\in\mathcal{W}_{\delta}$ 满足 $\|w^{\ell}-w\|_{2}\leq\delta$。根据标准覆盖网结果，我们知道 $N_{\delta}\leq(1+\frac{D}{\delta})^{d}$。通过联合界，我们知道以至少 $1-4dN_{\delta}e^{-2t}$ 的概率，(40) 和 (41) 中的界对所有 $w=w^{\ell}\in\mathcal{W}_{\delta}$ 和 $k\in[d]$ 成立。通过汇集所有 $k$ 坐标并使用假设 3，我们知道这意味着对所有 $w^{\ell}\in\mathcal{W}_{\delta}$ 有：

$$ 
\left\|g(w^{\ell})-\nabla F(w^{\ell})\right\|_{2}\leq\frac{C_{\epsilon}}{\sqrt{n}}V\left(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{S}{\sqrt{n}}\right).\qquad(43) 
$$
然后，考虑任意 $w\in\mathcal{W}$。假设 $\|w^{\ell}-w\|_{2}\leq\delta$。
由于根据假设 1，我们假设对于每个 $k\in[d]$，
偏导数 $\partial_{k}f(w;z)$ 对所有 $z$ 是 $L_{k}$-Lipschitz 的，我们知道对于每个正常机器 $i\in[m]\setminus\mathcal{B}$ 有：

$$ 
\left|g_{k}^{i}(w)-g_{k}^{i}(w^{\ell})\right|\leq L_{k}\delta. 
$$ 

那么，根据 (39) 中 $\widetilde{p}(z;w,k)$ 的定义，
我们知道对于任意 $z\in \mathbb{R}$，有 $\widetilde{p}(z+L_{k}\delta;w,k)\geq\widetilde{p}(z;w^{\ell},k)$ 和 $\widetilde{p}(z-L_{k}\delta;w,k)\leq\widetilde{p}(z;w^{\ell},k)$。那么，(40) 和 (41) 中的界得到：

$$ 
\widetilde{p}\left(\partial_{k}F(w^{\ell})+L_{k}\delta+C_{\epsilon}\frac{\sigma_{k}(w^{\ell})}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma_{k}(w^{\ell})}{\sqrt{n}});w,k\right)\geq\frac{1}{2}+\alpha,\qquad(44) 
$$
和

$$ 
\widetilde{p}\left(\partial_{k}F(w^{\ell})-L_{k}\delta-C_{\epsilon}\frac{\sigma_{k}(w^{\ell})}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma_{k}(w^{\ell})}{\sqrt{n}});w,k\right)\leq\frac{1}{2}-\alpha.\qquad(45) 
$$ 

利用 $\left|\partial_{k}F(w^{\ell})-\partial_{k}F(w)\right|\leq L_{k}\delta$ 的事实和推论 1，我们有：

$$ 
\left|g_{k}(w)-\partial_{k}F(w)\right|\leq 2L_{k}\delta+C_{\epsilon}\frac{\sigma_{k}(w^{\ell})}{\sqrt{n}}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma_{k}(w^{\ell})}{\sqrt{n}}). 
$$ 

再次，通过汇集所有 $k$ 坐标我们得到：

$$ 
\left\|g(w)-\nabla F(w)\right\|_{2}^{2}\leq 8\delta^{2}\sum_{k=1}^{d}L_{k}^{2}+2\frac{C_{\epsilon}^{2}}{n}\sum_{k=1}^{d}\sigma_{k}^{2}(w^{\ell})\left(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{\gamma_{k}(w^{\ell})}{\sqrt{n}}\right)^{2}, 
$$ 

其中我们使用了 $(a+b)^{2}\leq 2(a^{2}+b^{2})$ 的事实。然后，根据假设 2 和 3，我们进一步得到：

$$ 
\left\|g(w)-\nabla F(w)\right\|_{2}\leq 2\sqrt{2}\delta\widehat{L}+\sqrt{2}\frac{C_{\epsilon}}{\sqrt{n}}V\left(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+0.4748\frac{S}{\sqrt{n}}\right),\qquad(46) 
$$ 

其中我们使用了 $\sqrt{a+b}\leq\sqrt{a}+\sqrt{b}$ 的事实。结合 (43) 和 (46)，我们得出结论：
对于任意 $\delta>0$，以至少 $1-4dN_{\delta}e^{-2t}$ 的概率，(46) 对所有 $w\in\mathcal{W}$ 成立。
我们简单地选择 $\delta=\frac{1}{nm\widehat{L}}$ 和 $t=d\log(1+nm\widehat{L}D)$。
那么，我们知道以至少 $1-\frac{4d}{(1+nm\widehat{L}D)^{d}}$ 的概率，对于所有 $w\in\mathcal{W}$ 有：
**在这里，δ 是一个由我们自己选择的、大于零的实数。它用来定义一个名为 W_δ 的有限点集（即“覆盖网”），这个点集具有以下性质：对于整个参数空间 W 中的任意一个点 w，都必然能在 W_δ 中找到一个点 w^l，使得这两点之间的欧几里得距离 ||w^l - w||₂ 小于或等于 δ。**

**在这里，t也是一个数学层面的工具，用来量化概率和误差**
$$ 
\left\|g(w)-\nabla F(w)\right\|_{2}\leq 2\sqrt{2}\frac{1}{nm}+\sqrt{2}\frac{C_{\epsilon}}{\sqrt{n}}V\left(\alpha+\sqrt{\frac{d\log(1+nm\widehat{L}D)}{m(1-\alpha)}}+0.4748\frac{S}{\sqrt{n}}\right). 
$$ 
##### B.2 引理 1 的证明
我们回顾 Berry-Esseen 定理和有界差分不等式，它们在这个证明中很有用。

**定理 9** (Berry-Esseen 定理). 假设 $Y_{1},\ldots,Y_{n}$ 是随机变量 $Y$ 的独立同分布副本，$Y$ 的均值为 $\mu$，方差为 $\sigma^{2}$，且满足 $\mathbb{E}\left[\left|Y-\mu\right|^{3}\right]<\infty$。那么，
连接**​理想分布​**​ 和 ​**​真实分布​**​
**对于有限的样本量 n，真实分布 Φn​(z)与理想正态分布 Φ(z)的​​最大差距​​不会超过 Cn**

$$ 
\sup\limits_{s\in \mathbb{R}}\left|\mathbb{P}\left\{\sqrt{n}\frac{\bar{Y}-\mu}{\sigma}\leq s\right\}-\Phi(s)\right|\leq 0.4748\frac{\mathbb{E}\left[\left|Y-\mu\right|^{3}\right]}{\sigma^{3}\sqrt{n}}, 
$$ 

其中 $\bar{Y}=\frac{1}{n}\sum_{i=1}^{n}Y_{i}$，$\Phi(s)$ 是标准正态随机变量的累积分布函数。

**定理 10** (有界差分不等式). 设 $X_{1},\ldots,X_{n}$ 是独立同分布随机变量，并假设 $Z=g(X_{1},\ldots,X_{n})$，其中 $g$ 满足对于所有 $j\in[n]$ 和所有 $x_{1},x_{2},\ldots,x_{j},x_{j}^{\prime},\ldots,x_{n}$，
连接**真实分布​**​ 和 ​**​经验分布​**​
$$ 
\left|g(x_{1},\ldots,x_{j-1},x_{j},x_{j+1},\ldots,x_{n})-g(x_{1},\ldots,x_{j-1},x_{j}^{\prime},x_{j+1},\ldots,x_{n})\right|\leq c_{j}. 
$$ 
那么对于任意 $t\geq 0$，
$$ 
\mathbb{P}\left\{Z-\mathbb{E}[Z]\geq t\right\}\leq\exp\left(-\frac{2t^{2}}{\sum_{j=1}^{n}c_{j}^{2}}\right) 
$$ 
和

$$ 
\mathbb{P}\left\{Z-\mathbb{E}[Z]\leq -t\right\}\leq\exp\left(-\frac{2t^{2}}{\sum_{j=1}^{n}c_{j}^{2}}\right). 
$$ 

令 $\sigma_{n}:=\frac{\sigma}{\sqrt{n}}$ 和 $c_{n}:=0.4748\frac{\mathbb{E}\left[\left|x-\mu\right|^{3}\right]}{\sigma^{3}\sqrt{n}}=0.4748\frac{\gamma(x)}{\sqrt{n}}$。
对所有 $i\in[m]$ 定义 $W_{i}:=\frac{\bar{x}^{i}-\mu}{\sigma_{n}}$，并令 $\Phi_{n}(\cdot)$ 是任意 $i\in[m]\setminus\mathcal{B}$ 的 $W_{i}$ 的分布函数。我们还定义 ${W_{i}:i\in[m]\setminus\mathcal{B}}$ 的经验分布函数为 $\widetilde{\Phi}_{n}(\cdot)$，即 $\widetilde{\Phi}_{n}(z)=\frac{1}{m(1-\alpha)}\sum_{i\in[m]\setminus\mathcal{B}}\mathbb{1}\left(W_{i}\leq z\right)$。
因此，我们有：

$$ 
\widetilde{\Phi}_{n}(z)=\widetilde{p}(\sigma_{n}z+\mu).\qquad(47) 
$$ 

然后我们关注 $\widetilde{\Phi}_{n}(z)$。我们知道对于任意 $z\in \mathbb{R}$，$\mathbb{E}[\widetilde{\Phi}_{n}(z)]=\Phi_{n}(z)$。那么，由于有界差分不等式满足 $c_{j}=\frac{1}{m(1-\alpha)}$，我们对任意 $t>0$ 有：

$$ 
\left|\widetilde{\Phi}_{n}(z)-\Phi_{n}(z)\right|\leq\sqrt{\frac{t}{m(1-\alpha)}},\qquad(48) 
$$ 

以至少 $1-4e^{-2t}$ 的概率成立。下一步是选择 $z_{1}$ 和 $z_{2}$。根据定理 9，我们知道：

$$ 
\Phi_{n}(z_{1})\geq\Phi(z_{1})-c_{n}, 
$$
因此，只需找到 $z_{1}$ 使得：

$$ 
\Phi(z_{1})=\frac{1}{2}+\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n}. 
$$
根据均值定理，我们知道存在 $\xi\in[0,z_{1}]$ 使得：

$$ 
\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n}=z_{1}\Phi^{\prime}(\xi)=\frac{z_{1}}{\sqrt{2\pi}}e^{-\frac{\xi^{2}}{2}}\geq\frac{z_{1}}{\sqrt{2\pi}}e^{-\frac{z_{1}^{2}}{2}}. 
$$ 

假设对于某个固定常数 $\epsilon\in(0,1/2)$，我们有：

$$ 
\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n}\leq\frac{1}{2}-\epsilon. 
$$ 

那么，我们知道 $z_{1}\leq\Phi^{-1}(1-\epsilon)$，因此我们有：

$$ 
\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n}\geq\frac{z_{1}}{\sqrt{2\pi}}\exp\left(-\frac{1}{2}(\Phi^{-1}(1-\epsilon))^{2}\right), 
$$ 

这得到：

$$ 
z_{1}\leq\sqrt{2\pi}\exp\left(\frac{1}{2}(\Phi^{-1}(1-\epsilon))^{2}\right)\left(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n}\right). 
$$ 

类似地：

$$ 
z_{2}\geq-\sqrt{2\pi}\exp\left(\frac{1}{2}(\Phi^{-1}(1-\epsilon))^{2}\right)\left(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n}\right). 
$$ 

为简单起见，令 $C_{\epsilon}:=\sqrt{2\pi}\exp\left(\frac{1}{2}(\Phi^{-1}(1-\epsilon))^{2}\right)$。我们得出结论：以概率 $1-4e^{-2t}$，我们有：

$$ 
\widetilde{p}\left(\mu+C_{\epsilon}\sigma_{n}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n})\right)\geq\frac{1}{2}+\alpha, 
$$ 

和

$$ 
\widetilde{p}\left(\mu-C_{\epsilon}\sigma_{n}(\alpha+\sqrt{\frac{t}{m(1-\alpha)}}+c_{n})\right)\leq\frac{1}{2}-\alpha. 
$$
 #附录B

### 定理二 凸集
**假设 4** ($\mathcal{W}$ 的大小). 参数空间 $\mathcal{W}$ 包含以下以 $w^{*}$ 为中心的 $\ell_{2}$ 球：
$\{ w \in \mathbb{R}^{d} : \left\| w - w^{*} \right\|_{2} \leq 2 \left\| w^{0} - w^{*} \right\|_{2} \}$。

**定理 2.** 考虑算法 1 中的选项 I。假设假设 1、2、3 和 4 成立，总体损失 $F(\cdot)$ 是凸函数，且 $\alpha$ 满足对于某个 $\epsilon>0$ 的式 (2)。按式 (3) 定义 $\Delta$，并选择步长 $\eta=1 / L_{F}$。那么，在至少 $1-\frac{4 d}{(1+n m \widehat{L} D)^{d}}$ 的概率下，经过 $T=\frac{L_{F}}{\Delta} \| w^{0}-w^{*} \|_{2}$ 次并行迭代后，我们有

$$
F\left(w^{T}\right)-F\left(w^{*}\right) \leq 16\left\| w^{0}-w^{*}\right\| _{2} \Delta\left(1+\frac{1}{2 L_{F}} \Delta\right) .
$$
##### 附录 C：定理 2 的证明

由于定理 8 的成立不依赖于 $F(w)$ 的凸性假设，当 $F(w)$ 是非强凸函数时，不等式 (27) 对所有 $w\in\mathcal{W}$ 成立的事件仍然以至少 $1-\frac{4d}{(1+nm\widetilde{L}D)^{d}}$ 的概率发生。我们以此事件为条件进行证明。

我们首先证明，当假设 4 满足且选择步长 $\eta=\frac{1}{L_{F}}$ 时，迭代序列 $w^{t}$ 即使不进行投影操作也会始终保持在可行域 $\mathcal{W}$ 内。定义：

$$
w^{t+1}=w^{t}-\eta g(w^{t}),\quad t=0,1,\ldots,T-1
$$

则对所有 $t=0,1,\ldots,T$ 有 $w^{t}\in\mathcal{W}$。为证明这一点，我们有：

$$
\|w^{t+1}-w^{*}\|_{2}\leq\|w^{t}-\eta\nabla F(w^{t})-w^{*}\|_{2}+\eta\|g(w^{t})-\nabla F(w^{t})\|_{2}
$$

进一步计算：

$$
\begin{align*}
\|w^{t}-\eta\nabla F(w^{t})-w^{*}\|_{2}^{2} & 
=\|w^{t}-w^{*}\|_{2}^{2}-2\eta\langle\nabla F(w^{t}),w^{t}-w^{*}\rangle+\eta^{2}\|\nabla F(w^{t})\|_{2}^{2} \\
 & 由F的凸且光滑性可以得到: \\
 &\leq\|w^{t}-w^{*}\|_{2}^{2}-2\eta\frac{1}{L_{F}}\|\nabla F(w^{t})\|_{2}^{2}+\eta^{2}\|\nabla F(w^{t})\|_{2}^{2} \\
 &
 令步长为\frac{1}{L_f}得到：\\& 
 =\|w^{t}-w^{*}\|_{2}^{2}-\frac{1}{L_{F}^{2}}\|\nabla F(w^{t})\|_{2}^{2}\\& 
进而得到梯度步的精确更新下，离W*的距离不增加
 \\
& \leq\|w^{t}-w^{*}\|_{2}^{2}
\end{align*}
$$

其中不等式源于凸函数的共轭性。
利用带有误差的梯度估计，可以知道
![[Pasted image 20251011151614.png|200]]
![[Pasted image 20251011151642.png]]
![[Pasted image 20251011151649.png]]
再利用三角不等式
![[Pasted image 20251011151732.png]]
因此得到：

$$
\|w^{t+1}-w^{*}\|_{2}\leq\|w^{t}-w^{*}\|_{2}+\frac{\Delta}{L_{F}}
$$

由于 $T=\frac{L_{F}D_{0}}{\Delta}$，根据假设 4 可知对所有 $t=0,1,\ldots,T$ 有 $w^{t}\in\mathcal{W}$。
其中D0是初始距离，Δ是误差上界，根据递推关系可以得到上界随着轮次逐渐增长

定义 $D_{t}:=\|w^{0}-w^{*}\|_{2}+\frac{t\Delta}{L_{F}}$，$t=0,1,\ldots,T$。利用 $F(w)$ 的平滑性二次上界：

$$
\begin{align*}
F(w^{t+1}) & \leq F(w^{t})+\langle\nabla F(w^{t}),w^{t+1}-w^{t}\rangle+\frac{L_{F}}{2}\|w^{t+1}-w^{t}\|_{2}^{2} \\
 & 
 带入更新规则\\&=F(w^{t})+\eta\langle\nabla F(w^{t}),-g(w^{t})+\nabla F(w^{t})-\nabla F(w^{t})\rangle+\eta^{2}\frac{L_{F}}{2}\|g(w^{t})-\nabla F(w^{t})+\nabla F(w^{t})\|_{2}^{2}
\end{align*}
$$

取 $\eta=\frac{1}{L_{F}}$ 且 $\|g(w^{t})-\nabla F(w^{t})\|_{2}\leq\Delta$，通过简单代数运算得到：

$$
F(w^{t+1})\leq F(w^{t})-\frac{1}{2L_{F}}\|\nabla F(w^{t})\|_{2}^{2}+\frac{1}{2L_{F}}\Delta^{2}.\qquad(49)
$$

**引理 2.** 在 (27) 对所有 $w\in\mathcal{W}$ 成立的事件条件下，当 $F(w)$ 是凸函数时，通过运行 $T=\frac{L_{F}D_{0}}{\Delta}$ 次并行迭代，存在 $t\in\{0,1,2,\ldots,T\}$ 使得：

$$
F(w^{t})-F(w^{*})\leq 16D_{0}\Delta
$$

**证明.** 首先注意到由于 $T=\frac{L_{F}D_{0}}{\Delta}$，对所有 $t=0,1,\ldots,T$ 有 $D_{t}\leq 2D_{0}$。
根据凸函数的一阶最优性条件，对任意 $w$：
利用 **柯西施瓦茨不等式（![[Pasted image 20251011152427.png|200]]）** 有

$$
F(w)-F(w^{*})\leq\langle\nabla F(w),w-w^{*}\rangle\leq\|\nabla F(w)\|_{2}\|w-w^{*}\|_{2}
$$

因此：

$$
\|\nabla F(w)\|_{2}\geq\frac{F(w)-F(w^{*})}{\|w-w^{*}\|_{2}}.\qquad(50)
$$

**情况 1：**梯度小的情况下，接近平稳
存在 $t\in\{0,1,\ldots,T-1\}$ 使得 $\|\nabla F(w^{t})\|_{2}<\sqrt{2}\Delta$，则：

$$
F(w^{t})-F(w^{*})\leq\|\nabla F(w^{t})\|_{2}\|w^{t}-w^{*}\|_{2}\leq 2\sqrt{2}D_{0}\Delta
$$

**情况 2：**梯度大的情况下，有足够的下降速度 
对所有 $t\in\{0,1,\ldots,T-1\}$ 有 $\|\nabla F(w^{t})\|_{2}\geq\sqrt{2}\Delta$，则根据 (49) 和 (50)：

$$
\begin{align*}
F(w^{t+1})-F(w^{*}) & \leq F(w^{t})-F(w^{*})-\frac{1}{4L_{F}}\|\nabla F(w^{t})\|_{2}^{2} \\
 & \leq F(w^{t})-F(w^{*})-\frac{1}{4L_{F}D_{t}^{2}}(F(w^{t})-F(w^{*}))^{2}
\end{align*}
$$

两边同乘 $[(F(w^{t+1})-F(w^{*}))(F(w^{t})-F(w^{*})]^{-1}$ 并整理得：

$$
\begin{align*}
\frac{1}{F(w^{t+1})-F(w^{*})} & \geq\frac{1}{F(w^{t})-F(w^{*})}+\frac{1}{4L_{F}D_{t}^{2}}\frac{F(w^{t})-F(w^{*})}{F(w^{t+1})-F(w^{*})} \\
 & \geq\frac{1}{F(w^{t})-F(w^{*})}+\frac{1}{16L_{F}D_{0}^{2}}
\end{align*}
$$

这意味着：

$$
\frac{1}{F(w^{T})-F(w^{*})}\geq\frac{1}{F(w^{0})-F(w^{*})}+\frac{T}{16L_{F}D_{0}^{2}}\geq\frac{T}{16L_{F}D_{0}^{2}}
$$

利用 $T=\frac{L_{F}D_{0}}{\Delta}$ 得到 $F(w^{T})-F(w^{*})\leq 16D_{0}\Delta$。□

进一步证明 $F(w^{T})-F(w^{*})\leq 16D_{0}\Delta+\frac{1}{2L_{F}}\Delta^{2}$。设 $t=t_{0}$ 是首次满足 $F(w^{t})-F(w^{*})\leq 16D_{0}\Delta$ 的时刻，证明对任意 $t>t_{0}$ 有 $F(w^{t})-F(w^{*})\leq 16D_{0}\Delta+\frac{1}{2L_{F}}\Delta^{2}$。

若此命题不成立，设 $t_{1}>t_{0}$ 是首次满足 $F(w^{t})-F(w^{*})>16D_{0}\Delta+\frac{1}{2L_{F}}\Delta^{2}$ 的时刻，则必有 $F(w^{t_{1}-1})<F(w^{t_{1}})$。根据 (49) 应有：

$$
F(w^{t_{1}-1})-F(w^{*})\geq F(w^{t_{1}})-F(w^{*})-\frac{1}{2L_{F}}\Delta^{2}>16D_{0}\Delta
$$

根据 (50) 有：

$$
\|\nabla F(w^{t_{1}-1})\|_{2}\geq\frac{F(w^{t_{1}-1})-F(w^{*})}{\|w^{t_{1}-1}-w^{*}\|_{2}}>8\Delta
$$

根据 (49) 这意味着 $F(w^{t_{1}})\leq F(w^{t_{1}-1})$，与 $F(w^{t_{1}-1})<F(w^{t_{1}})$ 矛盾。
#附录C

### 定理三 非凸集情况
**假设 5** ($\mathcal{W}$ 的大小). 假设 $\forall w \in \mathcal{W}$，$\|\nabla F(w)\|_{2} \leq M$。我们假设 $\mathcal{W}$ 包含 $\ell_{2}$ 球体 $\{ w \in \mathbb{R}^{d} : \left\| w - w^{0} \right\|_{2} \leq \frac{2}{\Delta^{2}}(M+\Delta)(F(w^{0})-F(w^{*})) \}$，其中 $\Delta$ 的定义如 (3) 所示。


**定理 3.** 考虑算法 1 中的方案 I。假设假设 1、2、3 和 5 成立，且 $\alpha$ 满足对于某个 $\epsilon>0$ 的 (2)。按定理2中的定义 $\Delta$，并选择步长 $\eta=1 / L_{F}$。在至少 $1-\frac{4 d}{(1+n m \widehat{L} D)^{d}}$ 的概率下，经过 $T=\frac{2 L_{F}}{\Delta^{2}}(F(w^{0})-F(w^{*}))$ 次并行迭代后，我们有

$$
\min _{t=0,1, \ldots, T} \left\| \nabla F\left(w^{t}\right) \right\|_{2} \leq \sqrt{2} \Delta .
$$
##### 定理 3 的证明
由于定理 8 的成立不依赖于 $F(w)$ 的凸性假设，当 $F(w)$ 是非凸函数时，不等式 (27) 对所有 $w\in\mathcal{W}$ 成立的事件仍然以至少 $1-\frac{4d}{(1+nm\widehat{L}D)^{d}}$ 的概率发生。我们以此事件为条件进行证明。

我们首先证明，当假设 5 满足且选择步长 $\eta=\frac{1}{L_{F}}$ 时，迭代序列 $w^{t}$ 即使不进行投影操作也会始终保持在可行域 $\mathcal{W}$ 内。根据以下不等式：
$$
\|w^{t+1}-w^{*}\|_{2}\leq\|w^{t}-w^{*}\|_{2}+\eta(\|\nabla F(w^{t})\|_{2}+\|g(w^{t})-\nabla F(w^{t})\|_{2})\leq\|w^{t}-w^{*}\|_{2}+\frac{1}{L_{F}}(M+\Delta).
$$
那么，通过运行 $T=\frac{2L_{F}}{\Delta^{2}}(F(w^{0})-F(w^{*}))$ 次并行迭代，利用假设 5，我们知道即使不使用投影，对于 $t=0,1,\ldots,T$ 也有 $w^{t}\in\mathcal{W}$。
我们继续分析算法的收敛速率。根据 $F(w)$ 的平滑性，当选择 $\eta=\frac{1}{L_{F}}$ 时，不等式 (49) 仍然成立。具体来说，对于所有 $t=0,1,\ldots,T-1$：

$$
F(w^{t+1})-F(w^{*})\leq F(w^{t})-F(w^{*})-\frac{1}{2L_{F}}\|\nabla F(w^{t})\|_{2}^{2}+\frac{1}{2L_{F}}\Delta^{2}.\qquad(51)
$$

对 $t=0,1,\ldots,T-1$ 求和 (51)，我们得到：

$$
0\leq F(w^{T})-F(w^{*})\leq F(w^{0})-F(w^{*})-\frac{1}{2L_{F}}\sum_{t=0}^{T-1}\|\nabla F(w^{t})\|_{2}^{2}+\frac{T}{2L_{F}}\Delta^{2}.
$$
这意味着：

$$
\min\limits_{t=0,1,\ldots,T}\|\nabla F(w^{t})\|_{2}^{2}\leq 2\frac{L_{F}}{T}(F(w^{0})-F(w^{*}))+\Delta^{2},
$$

从而完成证明。
 #附录D
## 基于均值裁剪的梯度下降保证
接下来分析基于按坐标修剪均值的鲁棒分布式梯度下降算法，即算法1中的选项II。
这里需要对损失函数偏导数的尾部行为有更强的假设——特别是亚指数性。

**假设6**（亚指数梯度）。我们假设对于所有 $k \in [d]$ 和 $w \in \mathcal{W}$，$f(w;z)$ 关于 $w$ 的第 $k$ 个坐标的偏导数 $\partial_k f(w;z)$ 是 $v$-亚指数的。
亚指数性质意味着导数的所有矩都是有界的。这比基于中位数的GD算法所需的有限绝对偏度（即有限三阶矩）假设更强。
我们使用与命题1相同的例子，证明损失的导数确实是亚指数的。

**命题2.** 考虑命题1中的回归问题。对于所有 $k \in [d]$ 和 $w \in \mathcal{W}$，偏导数 $\partial_k f(w;z)$ 是 $2+\|w-w^*\|_2^2$-亚指数的。

命题2在附录A.3中证明。
现在继续建立基于修剪均值算法的统计保证，针对不同的损失函数类别。当总体损失 $F(\cdot)$ 是凸函数时，我们再次假设 $F(\cdot)$ 在 $\mathcal{W}$ 上的最小点也是其在 $\mathbb{R}^d$ 上的最小点。下面三个定理是基于中位数的GD算法定理1-3的类比。


### 定理4
**强凸损失：** 我们有以下结果。
**定理4.** 考虑算法1中的选项II。假设假设1和6成立，$F(\cdot)$ 是 $\lambda_F$-强凸的，且 $\alpha \leq \frac{1}{2} - \epsilon$ 对某个 $\epsilon > 0$ 成立。选择步长 $\eta = 1/L_F$。那么，以至少 $1 - \frac{4d}{(1+nmLD)^d}$ 的概率，经过 $T$ 次并行迭代后，我们有

$$
\|w^T - w^*\|_2 \leq \left(1 - \frac{\lambda_F}{L_F + \lambda_F}\right)^T \|w^0 - w^*\|_2 + \frac{2}{\lambda_F} \Delta,
$$

其中

$$
\Delta := \mathcal{O}\left(v\sqrt{\frac{d}{n} + \frac{1}{nm} \log(nmLD)}\right). \tag{5}
$$
我们在附录E中证明定理4。在(5)中，我们隐藏了通用常数和尺度为 $n$ 或 $1/nm$ 的高阶项。通过运行 $T = \frac{L_F + \lambda_F}{\lambda_F} \log\left(\frac{\lambda_F}{2\Delta} \|w^0 - w^*\|_2\right)$ 次并行迭代，我们可以获得满足 $\|w - w^*\|_2 = \mathcal{O}(\sqrt{d/n} + 1/\sqrt{nm})$ 的解 $w = w^T$。注意需要选择修剪均值的参数 $\beta$ 满足 $\beta \geq \alpha$。如果我们设置 $\beta = c\alpha$ 对于某个通用常数 $c \geq 1$，我们可以实现阶数最优的错误率 $\mathcal{O}(\sqrt{d/n} + 1/\sqrt{nm})$。

**证明**：
定理 4 的证明包含两个部分：
1. 对总体梯度的逐坐标修剪均值估计量的分析
2. 对稳健梯度下降算法的收敛性分析
由于第二部分与定理 1 的证明基本相同，我们在此主要关注第一部分。
**定理 11.** 定义

$$
\mathbf{g}^{i}(\mathbf{w}) = 
\begin{cases} 
\nabla F_{i}(\mathbf{w}) & i \in [m] \setminus \mathcal{B}, \\
* & i \in \mathcal{B}.
\end{cases} \tag{52}
$$

以及 $\mathbf{g}^{i}(\mathbf{w})$ 的逐坐标修剪均值：

$$
\mathbf{g}(\mathbf{w}) = \operatorname{trmean}_{\beta} \{\mathbf{g}^{i}(\mathbf{w}) : i \in [m]\}. \tag{53}
$$

假设假设 1 和 6 成立，且 $\alpha \leq \beta \leq \frac{1}{2} - \epsilon$。那么，以至少 $1 - \frac{2d(m+1)}{(1+nm\widehat{L}D)^{d}}$ 的概率，对所有 $\mathbf{w} \in \mathcal{W}$ 有

$$
\|\mathbf{g}(\mathbf{w}) - \nabla F(\mathbf{w})\|_{2} \leq \frac{v}{\epsilon} \left( \frac{3\sqrt{2}\beta d}{\sqrt{n}} + \frac{2d}{\sqrt{nm}} \right) \sqrt{\log(1+nm\widehat{L}D) + \frac{1}{d}\log m} + \widetilde{\mathcal{O}} \left( \frac{\beta}{n} + \frac{1}{nm} \right).
$$
**证明.** 见附录 E.1。
证明的其余部分与定理 1 的证明基本相同。实际上，我们本质上是分析一个梯度带有有界噪声的梯度下降算法。在附录 B 的定理 1 证明中，梯度噪声的界为

$$
\Delta = \sqrt{2} \frac{C_{\epsilon}}{\sqrt{n}} V \left( \alpha + \sqrt{ \frac{d \log(1+nm\widehat{L}D)}{m(1-\alpha)} } + 0.4748 \frac{S}{\sqrt{n}} \right) + 2\sqrt{2} \frac{1}{nm},
$$

而这里我们将 $\Delta$ 替换为 $\Delta^{\prime}$：

$$
\Delta^{\prime} := \frac{v}{\epsilon} \left( \frac{3\sqrt{2}\beta d}{\sqrt{n}} + \frac{2d}{\sqrt{nm}} \right) \sqrt{\log(1+nm\widehat{L}D) + \frac{1}{d}\log m} + \widetilde{\mathcal{O}} \left( \frac{\beta}{n} + \frac{1}{nm} \right),
$$

相同的分析仍然适用。因此，我们在此省略分析的细节。
**备注 1.** 当总体风险函数 $F(\mathbf{w})$ 是非强凸或非凸时，相同的论证仍然成立。可以简单地将定理 2 和 3 中梯度噪声的界 $\Delta$ 替换为此处的 $\Delta^{\prime}$。因此我们在此省略细节。
#### 附录 E.1：定理 11 的证明

定理 11 的证明依赖于对存在对抗数据时均值修剪均值估计量的分析以及覆盖网论证。我们首先考虑一维随机变量的鲁棒估计的一般问题。
假设有 $m$ 个工作机器，其中 $q$ 个是拜占庭机器，存储 $n$ 个对抗数据（回忆 $\alpha := q/m$）。其他 $m(1-\alpha)$ 个正常工作机器各自存储某个一维随机变量 $x \sim \mathcal{D}$ 的 $n$ 个独立同分布样本。
假设 $x$ 是 $v$-亚指数的，且令 $\mu := \mathbb{E}[x]$。
用 $x^{i,j}$ 表示第 $i$ 个工作机器中的第 $j$ 个样本。此外，定义 $\bar{x}^{i}$ 为第 $i$ 个机器中样本的平均值，即 $\bar{x}^{i} = \frac{1}{n}\sum_{j=1}^{n}x^{i,j}$。
我们有以下关于 $\bar{x}^{i}$, $i \in [m]$ 的修剪均值的结果。

**引理 3.** 假设所有正常机器上的一维样本是独立同分布的 $v$-亚指数分布，均值为 $\mu$。那么，对于任意 $t \geq 0$，有
$$
\mathbb{P}\left( \left| \frac{1}{(1-\alpha)m} \sum_{i \in [m] \setminus \mathcal{B}} \bar{x}^{i} - \mu \right| \geq t \right) \leq 2 \exp \left( -(1-\alpha)mn \min \left( \frac{t}{2v}, \frac{t^{2}}{2v^{2}} \right) \right)
$$

且对于任意 $s \geq 0$，有

$$
\mathbb{P}\left( \max_{i \in [m] \setminus \mathcal{B}} |\bar{x}^{i} - \mu| \geq s \right) \leq 2(1-\alpha)m \exp \left( -n \min \left( \frac{s}{2v}, \frac{s^{2}}{2v^{2}} \right) \right)
$$

且当 $\beta \geq \alpha$，$\left| \frac{1}{(1-\alpha)m} \sum_{i \in [m] \setminus \mathcal{B}} \bar{x}^{i} - \mu \right| \leq t$，且 $\max_{i \in [m] \setminus \mathcal{B}} |\bar{x}^{i} - \mu| \leq s$ 时，有

$$
\left| \operatorname{trmean}_{\beta} \{\bar{x}^{i} : i \in [m]\} - \mu \right| \leq t + \frac{3\beta s}{1-2\beta}
$$

**证明.** 见附录 E.2。
引理 3 可以直接应用于损失函数的第 $k$ 个偏导数。由于我们假设对于任意 $k \in [d]$ 和 $w \in \mathcal{W}$，$\partial_{k} f(w;z)$ 是 $v$-亚指数的，那么对于任意 $t \geq 0$, $s \geq 0$，有
**均值集中不等式​**：完好机器的局部估计的均值接近真实梯度分量。

$$
\mathbb{P}\left( \left| \frac{1}{(1-\alpha)m} \sum_{i \in [m] \setminus \mathcal{B}} g_{k}^{i}(w) - \partial_{k} F(w) \right| \geq t \right) \leq 2 \exp \left( -(1-\alpha)mn \min \left( \frac{t}{2v}, \frac{t^{2}}{2v^{2}} \right) \right) \tag{54}
$$
​**​极大值集中不等式​**​：完好机器的局部估计的极大偏差有界。
$$
\mathbb{P}\left( \max_{i \in [m] \setminus \mathcal{B}} |g_{k}^{i}(w) - \partial_{k} F(w)| \geq s \right) \leq 2(1-\alpha)m \exp \left( -n \min \left( \frac{s}{2v}, \frac{s^{2}}{2v^{2}} \right) \right) \tag{55}
$$

且因此以至少

$$
1 - 2 \exp \left( -(1-\alpha)mn \min \left( \frac{t}{2v}, \frac{t^{2}}{2v^{2}} \right) \right) - 2(1-\alpha)m \exp \left( -n \min \left( \frac{s}{2v}, \frac{s^{2}}{2v^{2}} \right) \right)
$$

的概率，有
**截断均值误差界​**​：如果以上两个界成立，则截断均值接近真实均值
**扩展到所有 w∈W和所有坐标**
$$
|g_{k}(w) - \partial_{k} F(w)| = |\operatorname{trmean}_{\beta} \{g_{k}^{i}(w) : i \in [m]\} - \partial_{k} F(w)| \leq t + \frac{3\beta s}{1-2\beta} \tag{56}
$$

为了将此结果扩展到所有 $w \in \mathcal{W}$ 和所有 $d$ 个坐标，我们需要使用联合界和覆盖网论证。
令 $\mathcal{W}_{\delta} = \{w^{1}, w^{2}, \ldots, w^{N_{\delta}}\}$ 是 $\mathcal{W}$ 的有限子集，使得对于任意 $w \in \mathcal{W}$，存在 $w^{\ell} \in \mathcal{W}_{\delta}$ 满足 $\|w^{\ell} - w\|_{2} \leq \delta$。
根据标准覆盖网结果（Vershynin, 2010），我们知道 $N_{\delta} \leq (1 + \frac{D}{\delta})^{d}$。通过联合界，我们知道以至少

$$
1 - 2dN_{\delta} \exp \left( -(1-\alpha)mn \min \left( \frac{t}{2v}, \frac{t^{2}}{2v^{2}} \right) \right)
$$

的概率，界 $\left| \frac{1}{(1-\alpha)m} \sum_{i \in [m] \setminus \mathcal{B}} g_{k}^{i}(w) - \partial_{k} F(w) \right| \leq t$ 对所有 $w = w^{\ell} \in \mathcal{W}_{\delta}$ 和 $k \in [d]$ 成立，且以至少

$$
1 - 2(1-\alpha)dmN_{\delta} \exp \left( -n \min \left( \frac{s}{2v}, \frac{s^{2}}{2v^{2}} \right) \right)
$$

的概率，界 $\max_{i \in [m] \setminus \mathcal{B}} |g_{k}^{i}(w) - \partial_{k} F(w)| \leq s$ 对所有 $w = w^{\ell} \in \mathcal{W}_{\delta}$ 和 $k \in [d]$ 成立。通过汇集所有 $k$ 坐标，我们知道这意味着对所有 $w^{\ell} \in \mathcal{W}_{\delta}$，有

$$
\|g(w^{\ell}) - \nabla F(w^{\ell})\|_{2} \leq \sqrt{d} \left( t + \frac{3\beta s}{1-2\beta} \right) \tag{57}
$$

然后，考虑任意 $w \in \mathcal{W}$。假设 $\|w^{\ell} - w\|_{2} \leq \delta$。由于根据假设 1，我们假设对于每个 $k \in [d]$，偏导数 $\partial_{k} f(w;z)$ 对所有 $z$ 是 $L_{k}$-Lipschitz 的，我们知道对于每个正常机器 $i \in [m] \setminus \mathcal{B}$，有
**从离散覆盖网扩展到连续集合**
$$
|g_{k}^{i}(w) - g_{k}^{i}(w^{\ell})| \leq L_{k} \delta, \quad |\partial_{k} F(w) - \partial_{k} F(w^{\ell})| \leq L_{k} \delta
$$

这意味着如果界 $\left| \frac{1}{(1-\alpha)m} \sum_{i \in [m] \setminus \mathcal{B}} g_{k}^{i}(w) - \partial_{k} F(w) \right| \leq t$ 和 $\max_{i \in [m] \setminus \mathcal{B}} |g_{k}^{i}(w) - \partial_{k} F(w)| \leq s$ 对所有 $w^{\ell} \in \mathcal{W}_{\delta}$ 和 $k \in [d]$ 成立，那么

$$
\left| \frac{1}{(1-\alpha)m} \sum_{i \in [m] \setminus \mathcal{B}} g_{k}^{i}(w) - \partial_{k} F(w) \right| \leq t + 2L_{k} \delta
$$

和

$$
\max_{i \in [m] \setminus \mathcal{B}} |g_{k}^{i}(w) - \partial_{k} F(w)| \leq s + 2L_{k} \delta
$$

对所有 $w \in \mathcal{W}$ 成立。这意味着对所有 $w \in \mathcal{W}$ 和 $k \in [d]$，有

$$
|g_{k}(w) - \partial_{k} F(w)| = |\operatorname{trmean}_{\beta} \{g_{k}^{i}(w) : i \in [m]\} - \partial_{k} F(w)| \leq t + \frac{3\beta s}{1-2\beta} + 2(1 + \frac{3\beta}{1-2\beta}) L_{k} \delta
$$

从而得到
**最终误差界与参数选择**

$$
\|g(w) - \nabla F(w)\|_{2} \leq \sqrt{2d} \left( t + \frac{3\beta s}{1-2\beta} \right) + 2\sqrt{2}(1 + \frac{3\beta}{1-2\beta}) \widetilde{L} \delta
$$

通过选择 $\delta = \frac{1}{nm\widetilde{L}}$，

$$
t = v \max \left( \sqrt{\frac{8d}{nm} \log(1+nm\widetilde{L}D)}, \frac{8d}{nm} \log(1+nm\widetilde{L}D) \right)
$$

$$
s = v \max \left( \sqrt{\frac{4}{n}(d \log(1+nm\widetilde{L}D) + \log m)}, \frac{4}{n}(d \log(1+nm\widetilde{L}D) + \log m) \right)
$$

并利用 $\beta \leq \frac{1}{2} - \epsilon$ 的事实完成证明。

#### 附录 E.2：引理 3 的证明
我们首先回忆亚指数随机变量的伯恩斯坦不等式。
**定理 12**（伯恩斯坦不等式）。假设 $X_{1}, X_{2}, \ldots, X_{n}$ 是独立同分布的 $v$-亚指数随机变量，均值为 $\mu$。那么对于任意 $t \geq 0$，有

$$
\mathbb{P}\left( \left| \frac{1}{n} \sum_{i=1}^{n} X_{i} - \mu \right| \geq t \right) \leq 2 \exp \left( -n \min \left( \frac{t}{2v}, \frac{t^{2}}{2v^{2}} \right) \right)
$$

因此，对于任意 $t \geq 0$，有

$$
\mathbb{P}\left( \left| \frac{1}{(1-\alpha)m} \sum_{i \in [m] \setminus \mathcal{B}} \bar{x}^{i} - \mu \right| \geq t \right) \leq 2 \exp \left( -(1-\alpha)mn \min \left( \frac{t}{2v}, \frac{t^{2}}{2v^{2}} \right) \right) \tag{58}
$$

类似地，对于任意 $i \in [m] \setminus \mathcal{B}$ 和任意 $s \geq 0$，有

$$
\mathbb{P}\left( |\bar{x}^{i} - \mu| \geq s \right) \leq 2 \exp \left( -n \min \left( \frac{s}{2v}, \frac{s^{2}}{2v^{2}} \right) \right)
$$

那么，通过联合界我们知道

$$
\mathbb{P}\left( \max_{i \in [m] \setminus \mathcal{B}} |\bar{x}^{i} - \mu| \geq s \right) \leq 2(1-\alpha)m \exp \left( -n \min \left( \frac{s}{2v}, \frac{s^{2}}{2v^{2}} \right) \right) \tag{59}
$$

我们继续分析修剪均值估计量。为简化符号，我们定义 $M = [m] \setminus \mathcal{B}$ 为所有正常工作机器的集合，$U \subseteq [m]$ 为所有未修剪机器的集合，$T \subseteq [m]$ 为所有修剪机器的集合。修剪均值估计量简单地计算

$$
\operatorname{trmean}_{\beta} \{\bar{x}^{i} : i \in [m]\} = \frac{1}{(1-2\beta)m} \sum_{i \in U} \bar{x}^{i}
$$

我们进一步有

$$
\begin{align*}
&\operatorname{trmean}_{\beta} \{\bar{x}^{i} : i \in [m]\} - \mu \\
&= \frac{1}{(1-2\beta)m} \sum_{i \in U} (\bar{x}^{i} - \mu) \\
&= \frac{1}{(1-2\beta)m} \left[ \sum_{i \in M} (\bar{x}^{i} - \mu) - \sum_{i \in M \setminus T} (\bar{x}^{i} - \mu) + \sum_{i \in \mathcal{B} \cap U} (\bar{x}^{i} - \mu) \right] \\
&\leq \frac{1}{(1-2\beta)m} \left[ \left| \sum_{i \in M} (\bar{x}^{i} - \mu) \right| + \left| \sum_{i \in M \setminus T} (\bar{x}^{i} - \mu) \right| + \left| \sum_{i \in \mathcal{B} \cap U} (\bar{x}^{i} - \mu) \right| \right] \tag{60}
\end{align*}
$$

我们还知道 $\left| \sum_{i \in M \setminus T} (\bar{x}^{i} - \mu) \right| \leq 2\beta m \max_{i \in M} |\bar{x}^{i} - \mu|$。此外，由于 $\beta \geq \alpha$，不失一般性，我们假设 $M \setminus T = \emptyset$，那么 $\left| \sum_{i \in \mathcal{B} \cap U} (\bar{x}^{i} - \mu) \right| \leq \beta m \max_{i \in M} |\bar{x}^{i} - \mu|$。然后我们直接得到所需的结果。
#附录E 

**非强凸损失：** 再次对 $\mathcal{W}$ 的大小施加假设4，我们有以下保证。
**定理5.** 考虑算法1中的选项II。假设假设1、4和6成立，$F(\cdot)$ 是凸函数，且 $\alpha \leq \frac{1}{2} - \epsilon$ 对某个 $\epsilon > 0$ 成立。选择步长 $\eta = 1/L_F$，并按照(5)定义 $\Delta$。那么，以至少 $1 - \frac{4d}{(1+nmLD)^d}$ 的概率，经过 $T = L_F \|w^0 - w^*\|_2 / \Delta$ 次并行迭代后，我们有

$$
F(w^T) - F(w^*) \leq 16\|w^0 - w^*\|_2 \Delta \left(1 + \frac{1}{2L_F} \Delta\right).
$$

定理5的证明与定理2类似，我们请读者参考附录E中的备注1。再次，通过选择 $\beta = c\alpha$ ($c \geq 1$)，我们在 $F(w)$ 的函数值上获得 $\mathcal{O}(\sqrt{d/n} + 1/\sqrt{nm})$ 的错误率。
**证明**：
#附录E备注1

**非凸损失：** 在这种情况下，对 $\mathcal{W}$ 的大小施加一个版本的假设5，我们有以下结果。

**定理6.** 考虑算法1中的选项II，并按照(5)定义 $\Delta$。假设假设1和6成立，假设5成立（其中 $\Delta$ 被替换为 $\widetilde{\Delta}$），且 $\alpha \leq \frac{1}{2} - \epsilon$ 对某个 $\epsilon > 0$ 成立。选择步长 $\eta = 1/L_F$。那么，以至少 $1 - \frac{4d}{(1+nmLD)^d}$ 的概率，经过 $T = \frac{2L_F}{\widetilde{\Delta}^2}(F(w^0) - F(w^*))$ 次并行迭代后，我们有

$$
\min_{t=0,1,\ldots,T} \|\nabla F(w^t)\|_2 \leq \sqrt{2} \widetilde{\Delta}.
$$

定理6的证明与定理3类似；见附录E中的备注1。通过选择 $\beta = c\alpha$ 且 $c \geq 1$，我们再次实现统计率 $\mathcal{O}(\sqrt{d/n} + 1/\sqrt{nm})$。
**证明**：
#附录E备注1