## 多表关系
一对多——在多的一方建立外键，指向一
多对多——建立第三张中间表维护两方关系
一对一——用于单表拆分，基础字段放在一张表、详情字段放另外一张

## 多表查询概述
笛卡尔积：A集合和B集合的所有组合情况

## 内连接
```mysql
隐式内连接
SELECT 字段列表 FROM 表1, 表2 WHERE 连接条件 [AND 其他筛选条件];

显式内连接
SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件 [WHERE 其他筛选条件];

-- 内连接演示 
-- 1. 查询每一个员工的姓名，及关联的部门的名称（隐式内连接实现） 
select emp.name,dept.name from emp,dept where emp.dept_id =dept.id
也可以起个别名方便查询
select e.name,d.name from emp e,dept d where e.dept_id =d.id
-- 2. 查询每一个员工的姓名，及关联的部门的名称（显式内连接实现）
select e.name,d.name from emp e inner join dept d on  e.dept_id =d.id;

```

## 外连接 
左表(A)        右表(B)
   ●──────┐    ┌──────●
   │  ●───┼────┼───●  │
   ●──────┘    └──────●
   ▲                  ▲
LEFT JOIN          RIGHT JOIN
包含A全量          包含B全量

```mysql
SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 连接条件 [WHERE 其他条件];

SELECT 字段列表 FROM 表1 RIGHT [OUTER] JOIN 表2 ON 连接条件 [WHERE 其他条件];

-- 左外连接实现（查询员工表所有数据及关联部门信息）
SELECT e.*, d.dept_name 
FROM emp e 
LEFT JOIN dept d ON e.dept_id = d.id;

-- 右外连接实现（查询部门表所有数据及关联员工信息）
SELECT d.*, e.name AS employee_name
FROM emp e 
RIGHT JOIN dept d ON e.dept_id = d.id;
```

## 自连接
1. 必须为同一张表设置不同的别名（如t1/t2）
2. 连接条件通常是层级关系字段（如parent_id）
3. 支持配合WHERE/ORDER BY等子句使用
4. 实际应用时需替换"表名"和具体字段名
```mysql
-- 自连接标准语法
SELECT t1.字段, t2.字段
FROM 表名 t1
JOIN 表名 t2 ON t1.关联字段 = t2.关联字段
[WHERE 其他条件];

-- 典型应用场景：查询员工及其直属上级
SELECT emp.name AS 员工, mgr.name AS 上级
FROM employee emp
JOIN employee mgr ON emp.manager_id = mgr.id;

-- 查询省市区层级数据
SELECT p.name AS 省, c.name AS 市, d.name AS 区
FROM region p
JOIN region c ON p.id = c.parent_id
JOIN region d ON c.id = d.parent_id;
```

## 联合查询-union
将多次查询结果放在一起
```mysql
select 语句
union all  //不加all相当于查询结果会去重
select 语句
```

## 子查询
SQL语句中嵌套SELECT语句，称为嵌套查询，又称子查询
```mysql
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);
```

| 操作符  | 描述                                   |
|---------|----------------------------------------|
| IN      | 在指定的集合范围之内，多选一             |
| NOT IN  | 不在指定的集合范围之内                   |
| ANY     | 子查询返回列表中，有任意一个满足即可       |
| SOME    | 与ANY等同，使用SOME的地方都可以使用ANY   |
| ALL     | 子查询返回列表的所有值都必须满足          |

## 多表查询案例
```mysql
员工表和部门表
-- 1. 查询员工的姓名、年龄、职位、部门信息（隐式内连接）
select e.name,e.age,e.position from emp e,dept d where e.dept_id = d.id;

-- 2. 查询年龄小于30岁的员工的姓名、年龄、职位、部门信息（显式内连接）  
select e.name,e.age,e.position from emp e inner join dept d on e.dept_id = d.id where e.age<30;

-- 3. 查询拥有员工的部门ID、部门名称  
select distinct d.id,d.name from emp e,dept e where e.dept_id = d.id
```
![[Pasted image 20250728112336.png|400]]