存储在数据库中一段SQL语句的集合，调用存储过程简化开发工作，减少数据在数据库和服务器之间的传输

## 基本语法

**创建与调用语法**
```mysql

通过delimiter $$ 设置分号符

create procedure 存储过程名称([参数列表])
begin
    --SQL语句
end;

call 名称([参数]);分号符位置
```

**查看已经有的**
```mysql
-- 查看所有存储过程
SHOW PROCEDURE STATUS;

-- 查看特定数据库的存储过程
SHOW PROCEDURE STATUS WHERE Db = 'your_database';

-- 查看存储过程定义
SHOW CREATE PROCEDURE sp_get_user_by_id;
```

```java
在注解中使用
@Select("{call sp_get_user_by_id(#{userId, mode=IN, jdbcType=INTEGER})}")
@Options(statementType = StatementType.CALLABLE)
User getUserById(@Param("userId") int userId);

<!-- 在Mapper XML中定义 -->
<select id="getUserById" statementType="CALLABLE" resultType="User">
  {call sp_get_user_by_id(#{userId, mode=IN, jdbcType=INTEGER})}
</select>
```

## 变量
**系统变量**——Global|Session
```mysql
-- 查看所有全局变量
SHOW GLOBAL VARIABLES;

-- 查看所有会话变量
SHOW SESSION VARIABLES;
SHOW VARIABLES;  -- 默认是SESSION

-- 查看特定变量
SHOW VARIABLES LIKE 'variable_name';
SHOW GLOBAL VARIABLES LIKE 'max_connections';

-- 设置全局变量（需要SUPER权限）
SET GLOBAL variable_name = value;
SET @@GLOBAL.variable_name = value;

-- 设置会话变量
SET SESSION variable_name = value;
SET @@SESSION.variable_name = value;
SET variable_name = value;  -- 默认是SESSION

-- 使用表达式设置
SET GLOBAL wait_timeout = 60 * 60;
```

**用户自定义变量**
```mysql
-- 使用 SET 赋值
SET @var_name = expr;
SET @var_name := expr;

-- 使用 SELECT 赋值
SELECT @var_name := expr;
SELECT expr INTO @var_name FROM table;

-- 变量名以 @ 开头
SET @my_var = 10;
SET @`var-name` = 20;  -- 特殊字符需要用反引号

-- 基本赋值
SET @max_salary = (SELECT MAX(salary) FROM employees);

-- 在查询中使用
SELECT @row_num := @row_num + 1 AS row_number, name 
FROM employees, (SELECT @row_num := 0) AS t;
```

**局部变量**(用在触发器，函数，存储过程)
```mysql
DECLARE var_name [, var_name]... type [DEFAULT value]
```


## IF
![[Pasted image 20250811110412.png|500]]
```
create procedure p3()
begin
    declare score int default 58;
    declare result varchar(10);
    if(score >= 85) then
        set result:='优秀'
    elseif score >=60 then
        set result:='及格'
    else 
        set result:='不及格'
    end if;
    select result;
end;
```
