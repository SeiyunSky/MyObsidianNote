**功能分析**
- 短链接跳转原理
- 创建短链接表
- 新增短链接
- HOST增加域名映射
- 分页查询短链接集合
- 编辑短链接
- 将短链接删除(回收站功能)
 ![[Pasted image 20250724165545.png]]
 3xx开头的代表重定向，表示网页发生了转移，需要重定向到对应的地址中去
 301 永久重定向——只会调用一次后端获取目标地址
 302 临时重定向 

### **短链接表结构**
短链接唯一性：
- 全局唯一
    单一短链接在所有域名下唯一，全平台唯一
- 域名下唯一
    仅仅在域名下唯一

### 短链接生成算法
![[Pasted image 20250724171636.png|300]]
![[Pasted image 20250724171724.png|500]]

### 短链接跳转
![[Pasted image 20250727154217.png|500]]
1. 缓存怎么办？访问缓存和数据库不存在短网址，数据库压力骤增。
2. 短时间内大量请求访问一个缓存过期短链接，那么就会造成缓存击穿。


## 零碎知识
shardingsphere配置代码
```XML
datasource:  
  # ShardingSphere 对 Driver 自定义，实现分库分表等隐藏逻辑  
  driver-class-name: org.apache.shardingsphere.driver.ShardingSphereDriver  
  # ShardingSphere 配置文件路径  
  url: jdbc:shardingsphere:classpath:shardingsphere-config-${database.env:dev}.yaml
```

全局时间配置
```xml
jackson:  
  date-format: yyyy-MM-dd HH:mm:ss  
  time-zone: GMT+8
```

远程调用
```java
利用HttpUtil实现功能
请求体、地址、参数

post
default Result<ShortLinkCreateRespDTO> createLink(ShortLinkCreateReqDTO requestParam){  
    String resultBodyStr = HttpUtil.post("http://127.0.0.1:8001/api/shortlink/v1/create", JSON.toJSONString(requestParam));  
    return JSON.parseObject(resultBodyStr, new TypeReference<Result<ShortLinkCreateRespDTO>>() {  
    });  
};

get
default Result<IPage<ShortLinkPageRespDTO>> pageShortLink(ShortLinkPageReqDTO requestParam){  
    //用hutool的httpUtil解决  
    Map<String,Object> map = new HashMap<>();  
    map.put("gid",requestParam.getGid());  
    map.put("current",requestParam.getCurrent());  
    map.put("size",requestParam.getSize());  
  
    //获得json字符串  
    String retPageStr = HttpUtil.get("http://127.0.0.1:8001/api/shortlink/v1/page",map);  
  
    return JSON.parseObject(retPageStr,new TypeReference<Result<IPage<ShortLinkPageRespDTO>>>(){  
    });  
}
```

分库分表参数
```xml
rules:  
  - !SHARDING  
    tables:  
      t_link:  
        # 真实数据节点，比如数据库源以及数据库在数据库中真实存在的  
        actualDataNodes: ds_0.t_link_${0..15}  
        # 分表策略  
        tableStrategy:  
          # 用于单分片键的标准分片场景  
          standard:  
            # 分片键  
            shardingColumn: gid  
            # 分片算法，对应 rules[0].shardingAlgorithms            shardingAlgorithmName: link_table_hash_mod  
    # 分片算法  
    shardingAlgorithms:  
      # 数据表分片算法  
      link_table_hash_mod:  
        # 根据分片键 Hash 分片  
        type: HASH_MOD  
        # 分片数量  
        props:  
          sharding-count: 16  
# 展现逻辑 SQL & 真实 SQLprops:  
  sql-show: true
```
